{
  "id": null,
  "uid": "ef5zdqbvm17uoc",
  "title": "JustNews System Overview",
  "description": "Infrastructure-focused view for host, network, and accelerator health",
  "tags": [
    "system",
    "infrastructure",
    "health"
  ],
  "timezone": "UTC",
  "refresh": "1m",
  "time": {
    "from": "now-6h",
    "to": "now"
  },
  "timepicker": {},
  "templating": {
    "list": [
      {
        "name": "instance",
        "label": "Instance",
        "type": "query",
        "query": "label_values(up{job=~\"justnews-.*\"}, instance)",
        "multi": true,
        "includeAll": true,
        "refresh": 1
      }
    ]
  },
  "annotations": {
    "list": []
  },
  "panels": [
    {
      "id": 1,
      "title": "Fleet Availability",
      "type": "stat",
      "description": "Number of justnews-* services reporting up=1",
      "gridPos": {
        "h": 4,
        "w": 6,
        "x": 0,
        "y": 0
      },
      "targets": [
        {
          "expr": "sum(up{job=~\"justnews-.*\"})",
          "legendFormat": "Fleet Availability"
        }
      ],
      "fieldConfig": {
        "defaults": {
          "unit": "none"
        },
        "overrides": []
      },
      "options": {
        "reduceOptions": {
          "calcs": [
            "lastNotNull"
          ]
        }
      }
    },
    {
      "id": 2,
      "title": "Average CPU (%)",
      "type": "stat",
      "description": "Fleet-wide average CPU utilisation over the last 5m",
      "gridPos": {
        "h": 4,
        "w": 6,
        "x": 6,
        "y": 0
      },
      "targets": [
        {
          "expr": "avg(100 - (avg by(instance) (irate(node_cpu_seconds_total{mode=\"idle\"}[5m])) * 100))",
          "legendFormat": "Average CPU (%)"
        }
      ],
      "fieldConfig": {
        "defaults": {
          "unit": "percent",
          "decimals": 1
        },
        "overrides": []
      },
      "options": {
        "reduceOptions": {
          "calcs": [
            "lastNotNull"
          ]
        }
      }
    },
    {
      "id": 3,
      "title": "Average Memory (%)",
      "type": "stat",
      "description": "Fleet-wide average memory pressure",
      "gridPos": {
        "h": 4,
        "w": 6,
        "x": 12,
        "y": 0
      },
      "targets": [
        {
          "expr": "avg((1 - node_memory_MemAvailable_bytes / node_memory_MemTotal_bytes) * 100)",
          "legendFormat": "Average Memory (%)"
        }
      ],
      "fieldConfig": {
        "defaults": {
          "unit": "percent",
          "decimals": 1
        },
        "overrides": []
      },
      "options": {
        "reduceOptions": {
          "calcs": [
            "lastNotNull"
          ]
        }
      }
    },
    {
      "id": 4,
      "title": "Average Disk Usage (%)",
      "type": "stat",
      "description": "Average root disk utilisation across hosts",
      "gridPos": {
        "h": 4,
        "w": 6,
        "x": 18,
        "y": 0
      },
      "targets": [
        {
          "expr": "avg((1 - node_filesystem_avail_bytes{mountpoint=\"/\",fstype!~\"tmpfs|devtmpfs\"} / node_filesystem_size_bytes{mountpoint=\"/\",fstype!~\"tmpfs|devtmpfs\"}) * 100)",
          "legendFormat": "Average Disk Usage (%)"
        }
      ],
      "fieldConfig": {
        "defaults": {
          "unit": "percent",
          "decimals": 1
        },
        "overrides": []
      },
      "options": {
        "reduceOptions": {
          "calcs": [
            "lastNotNull"
          ]
        }
      }
    },
    {
      "id": 5,
      "title": "CPU Usage by Instance",
      "type": "timeseries",
      "description": "Per-instance CPU utilisation (5m rate)",
      "gridPos": {
        "h": 8,
        "w": 12,
        "x": 0,
        "y": 4
      },
      "targets": [
        {
          "expr": "100 - (avg by(instance) (irate(node_cpu_seconds_total{mode=\"idle\"}[5m])) * 100)",
          "legendFormat": "{{instance}}"
        }
      ],
      "options": {
        "legend": {
          "displayMode": "list",
          "placement": "bottom"
        },
        "tooltip": {
          "mode": "multi",
          "sort": "none"
        }
      },
      "fieldConfig": {
        "defaults": {
          "unit": "percent"
        },
        "overrides": []
      }
    },
    {
      "id": 6,
      "title": "Memory Usage by Instance",
      "type": "timeseries",
      "description": "Per-instance memory pressure",
      "gridPos": {
        "h": 8,
        "w": 12,
        "x": 12,
        "y": 4
      },
      "targets": [
        {
          "expr": "(1 - node_memory_MemAvailable_bytes / node_memory_MemTotal_bytes) * 100",
          "legendFormat": "{{instance}}"
        }
      ],
      "options": {
        "legend": {
          "displayMode": "list",
          "placement": "bottom"
        },
        "tooltip": {
          "mode": "multi",
          "sort": "none"
        }
      },
      "fieldConfig": {
        "defaults": {
          "unit": "percent"
        },
        "overrides": []
      }
    },
    {
      "id": 7,
      "title": "Load Average (1m)",
      "type": "timeseries",
      "description": "Node load1 value per instance",
      "gridPos": {
        "h": 8,
        "w": 12,
        "x": 0,
        "y": 12
      },
      "targets": [
        {
          "expr": "node_load1",
          "legendFormat": "{{instance}}"
        }
      ],
      "options": {
        "legend": {
          "displayMode": "list",
          "placement": "bottom"
        },
        "tooltip": {
          "mode": "multi",
          "sort": "none"
        }
      },
      "fieldConfig": {
        "defaults": {
          "unit": "none"
        },
        "overrides": []
      }
    },
    {
      "id": 8,
      "title": "Network Throughput",
      "type": "timeseries",
      "description": "Combined receive + transmit throughput per instance",
      "gridPos": {
        "h": 8,
        "w": 12,
        "x": 12,
        "y": 12
      },
      "targets": [
        {
          "expr": "sum by(instance) (rate(node_network_receive_bytes_total[5m]) + rate(node_network_transmit_bytes_total[5m]))",
          "legendFormat": "{{instance}}"
        }
      ],
      "options": {
        "legend": {
          "displayMode": "list",
          "placement": "bottom"
        },
        "tooltip": {
          "mode": "multi",
          "sort": "none"
        }
      },
      "fieldConfig": {
        "defaults": {
          "unit": "Bps"
        },
        "overrides": []
      }
    },
    {
      "id": 9,
      "title": "Disk Pressure Hotspots",
      "type": "bargauge",
      "description": "Top instances by root filesystem usage",
      "gridPos": {
        "h": 8,
        "w": 12,
        "x": 0,
        "y": 20
      },
      "targets": [
        {
          "expr": "topk(10, (1 - node_filesystem_avail_bytes{fstype!~\"tmpfs|devtmpfs\", mountpoint=\"/\"} / node_filesystem_size_bytes{fstype!~\"tmpfs|devtmpfs\", mountpoint=\"/\"}) * 100)",
          "legendFormat": "{{instance}}"
        }
      ],
      "fieldConfig": {
        "defaults": {
          "unit": "percent"
        },
        "overrides": []
      },
      "options": {
        "orientation": "horizontal"
      }
    },
    {
      "id": 10,
      "title": "GPU Utilization",
      "type": "timeseries",
      "description": "GPU utilisation per accelerator",
      "gridPos": {
        "h": 8,
        "w": 12,
        "x": 12,
        "y": 20
      },
      "targets": [
        {
          "expr": "nvidia_gpu_utilization_ratio * 100",
          "legendFormat": "{{gpu_uuid}}"
        }
      ],
      "options": {
        "legend": {
          "displayMode": "list",
          "placement": "bottom"
        },
        "tooltip": {
          "mode": "multi",
          "sort": "none"
        }
      },
      "fieldConfig": {
        "defaults": {
          "unit": "percent"
        },
        "overrides": []
      }
    },
    {
      "id": 11,
      "title": "GPU Memory Usage (GB)",
      "type": "timeseries",
      "description": "GPU memory usage per accelerator",
      "gridPos": {
        "h": 8,
        "w": 12,
        "x": 0,
        "y": 28
      },
      "targets": [
        {
          "expr": "nvidia_gpu_memory_used_bytes / 1024 / 1024 / 1024",
          "legendFormat": "{{gpu_uuid}}"
        }
      ],
      "options": {
        "legend": {
          "displayMode": "list",
          "placement": "bottom"
        },
        "tooltip": {
          "mode": "multi",
          "sort": "none"
        }
      },
      "fieldConfig": {
        "defaults": {
          "unit": "gbytes"
        },
        "overrides": []
      }
    },
    {
      "id": 12,
      "title": "GPU Temperature p95 (15m)",
      "type": "stat",
      "description": "95th percentile GPU temperature across the fleet",
      "gridPos": {
        "h": 4,
        "w": 12,
        "x": 12,
        "y": 28
      },
      "targets": [
        {
          "expr": "quantile_over_time(0.95, nvidia_gpu_temperature_celsius[15m])",
          "legendFormat": "GPU Temperature p95 (15m)"
        }
      ],
      "fieldConfig": {
        "defaults": {
          "unit": "celsius",
          "decimals": 1
        },
        "overrides": []
      },
      "options": {
        "reduceOptions": {
          "calcs": [
            "lastNotNull"
          ]
        }
      }
    },
    {
      "id": 13,
      "title": "GPU Power Draw (avg)",
      "type": "stat",
      "description": "Average GPU power draw over the last scrape interval",
      "gridPos": {
        "h": 4,
        "w": 12,
        "x": 12,
        "y": 32
      },
      "targets": [
        {
          "expr": "avg(nvidia_gpu_power_draw_watts)",
          "legendFormat": "GPU Power Draw (avg)"
        }
      ],
      "fieldConfig": {
        "defaults": {
          "unit": "watt",
          "decimals": 1
        },
        "overrides": []
      },
      "options": {
        "reduceOptions": {
          "calcs": [
            "lastNotNull"
          ]
        }
      }
    },
    {
      "id": 200,
      "title": "MCP Bus Overall Health",
      "type": "stat",
      "description": "Overall MCP Bus health (0=healthy,1=degraded,2=unhealthy)",
      "gridPos": {
        "h": 4,
        "w": 6,
        "x": 0,
        "y": 36
      },
      "targets": [
        {
          "expr": "max(justnews_agent_health_status{agent=\"mcp_bus\",target=\"overall\"})",
          "legendFormat": "Overall"
        }
      ],
      "fieldConfig": {
        "defaults": {
          "unit": "none",
          "mappings": [
            {"type": "value", "options": {"0": {"text": "Healthy", "color": "green"}, "1": {"text": "Degraded", "color": "orange"}, "2": {"text": "Unhealthy", "color": "red"}, "3": {"text": "Unreachable", "color": "red"}, "4": {"text": "Unknown", "color": "gray"}}}
          ],
          "decimals": 0
        },
        "overrides": []
      }
    },
    {
      "id": 201,
      "title": "MCP Bus Agents Degraded Count",
      "type": "stat",
      "description": "Number of registered agents in a degraded/unhealthy state",
      "gridPos": {
        "h": 4,
        "w": 6,
        "x": 6,
        "y": 36
      },
      "targets": [
        {
          "expr": "sum(justnews_agent_health_status{target=\"per_agent\"} > 0)",
          "legendFormat": "Degraded Agents"
        }
      ],
      "fieldConfig": {
        "defaults": {
          "unit": "none",
          "decimals": 0
        },
        "overrides": []
      }
    },
    {
      "id": 202,
      "title": "MCP Bus Agent Status Table",
      "type": "table",
      "description": "Per-agent health status (0=healthy,1=degraded,2=unhealthy,3=unreachable,4=unknown)",
      "gridPos": {
        "h": 8,
        "w": 18,
        "x": 12,
        "y": 36
      },
      "targets": [
        {
          "expr": "justnews_agent_health_status{target=\"per_agent\"}",
          "legendFormat": "{{agent}}"
        }
      ],
      "fieldConfig": {
        "defaults": {
          "unit": "none",
          "decimals": 0
        },
        "overrides": []
      },
      "options": {
        "showHeader": true,
        "displayMode": "table"
      }
    }
  ],
  "version": 1,
  "schemaVersion": 36,
  "style": "dark"
}
