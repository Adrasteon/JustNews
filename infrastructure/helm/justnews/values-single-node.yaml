# Single-Node Optimized Values for JustNews K8s Deployment
# Optimized for AMD Ryzen 7 (16 cores) + 32GB RAM + RTX3090

# Global configuration
global:
  imageRegistry: ""
  imagePullSecrets: []
  storageClass: "local-path"  # Use local storage for single node

# JustNews application configuration
justnews:
  namespace: justnews

  image:
    registry: docker.io/library
    tag: latest
    pullPolicy: IfNotPresent

  serviceAccount:
    create: true
    name: justnews-agent-sa

  # Optimized resource limits for single node with OS overhead
  resources:
    limits:
      cpu: 600m    # Reduced from 750m to account for OS overhead
      memory: 1200Mi  # Reduced from 1.5Gi for memory safety (1.2Gi = 1200Mi)
    requests:
      cpu: 300m
      memory: 600Mi

  # GPU configuration - enable MPS sharing for concurrent usage on RTX 3090
  gpu:
    enabled: true
    resourceName: nvidia.com/gpu
    resourceCount: 1  # Single GPU with MPS sharing allows concurrent access

  # API Keys (set these in production)
  apiKeys:
    openai: "change_me_in_production"
    anthropic: "change_me_in_production"
    github: "change_me_in_production"

  security:
    secretKey: "change_me_in_production"
    jwtSecretKey: "change_me_in_production"

  external:
    newsApiKey: "change_me_in_production"
    twitterApiKey: "change_me_in_production"
    twitterApiSecret: "change_me_in_production"
    twitterAccessToken: "change_me_in_production"
    twitterAccessTokenSecret: "change_me_in_production"

  archive:
    storagePath: "/data/archive"
    retentionDays: 365

  training:
    online:
      enabled: true  # Enable online training with GPU headroom
    dataPath: "/data/training"

  metrics:
    enabled: true
    port: 9090

  logLevel: "INFO"
  environment: "development"  # Changed from production for single node
  debug: false

  # Optimized agent configurations for single node
  agents:
    # Core agents - keep enabled
    mcpBus:
      name: mcpBus
      enabled: true
      replicas: 1
      port: 8000
      gpuRequired: false

    chiefEditor:
      name: chiefEditor
      enabled: true
      replicas: 1
      port: 8001
      gpuRequired: false

    # balancer removed - responsibilities moved to critic/analytics/gpu_orchestrator

    memory:
      name: memory
      enabled: true
      replicas: 2  # Increased for better memory management
      port: 8007
      gpuRequired: false

    reasoning:
      name: reasoning
      enabled: true
      replicas: 1
      port: 8008
      gpuRequired: false

    critic:
      name: critic
      enabled: true
      replicas: 1
      port: 8006
      gpuRequired: false

    dashboard:
      name: dashboard
      enabled: true
      replicas: 1
      port: 8013
      gpuRequired: false

    analytics:
      name: analytics
      enabled: true
      replicas: 1
      port: 8011
      gpuRequired: false

    archive:
      name: archive
      enabled: true
      replicas: 1
      port: 8012
      gpuRequired: false

    # GPU agents - reduced replicas due to single GPU
    scout:
      name: scout
      enabled: true
      replicas: 1  # Keep 1 for GPU work
      port: 8002
      gpuRequired: true

    analyst:
      name: analyst
      enabled: true
      replicas: 1  # Keep 1 for GPU work
      port: 8004
      gpuRequired: true

    # Enable additional agents with GPU acceleration (MPS sharing)
    synthesizer:
      name: synthesizer
      enabled: true
      replicas: 1
      port: 8005
      gpuRequired: true  # Enable GPU with MPS sharing

    factChecker:
      name: factChecker
      enabled: true
      replicas: 1
      port: 8003
      gpuRequired: true  # Enable GPU with MPS sharing

    newsreader:
      name: newsreader
      enabled: true
      replicas: 1
      port: 8009
      gpuRequired: true  # Enable GPU with MPS sharing

    gpuOrchestrator:
      name: gpuOrchestrator
      enabled: true
      replicas: 1
      port: 8015
      gpuRequired: false  # Can run without GPU

# Infrastructure - reduced resources for single node
postgresql:
  enabled: false  # Temporarily disabled due to data corruption
  image:
    registry: docker.io
    repository: postgres
    tag: "15"
  auth:
    postgresPassword: "justnews_password"
    username: justnews
    password: "justnews_password"
    database: justnews
  architecture: standalone
  primary:
    persistence:
      enabled: false  # Temporarily disabled due to data corruption
      size: 20Gi  # Reduced from 50Gi
      storageClass: "local-path"
    resources:
      limits:
        cpu: 600m    # Reduced from 750m for OS compatibility
        memory: 1200Mi  # Reduced from 1.5Gi for memory safety
      requests:
        cpu: 300m
        memory: 600Mi

redis:
  enabled: true
  image:
    registry: docker.io
    repository: redis
    tag: "7"
  auth:
    password: "redis_password"
  architecture: standalone
  master:
    persistence:
      enabled: true
      size: 5Gi   # Reduced from 10Gi
      storageClass: "local-path"
    resources:
      limits:
        cpu: 300m  # Reduced from 375m
        memory: 600Mi  # Reduced from 768Mi for memory safety
      requests:
        cpu: 150m
        memory: 300Mi

prometheus:
  enabled: false  # Temporarily disabled due to data corruption
  image:
    registry: docker.io
    repository: prom/prometheus
    tag: "v2.45.0"
  server:
    persistentVolume:
      enabled: false  # Temporarily disabled due to data corruption
      size: 10Gi  # Reduced from 20Gi
      storageClass: "local-path"
    resources:
      limits:
        cpu: 500m    # Reduced from 1000m
        memory: 1000Mi  # Reduced from 2Gi
      requests:
        cpu: 250m
        memory: 512Mi

grafana:
  enabled: true
  image:
    registry: docker.io
    repository: grafana/grafana
    tag: "9.5.0"
  adminUser: admin
  adminPassword: "admin_password"
  persistence:
    enabled: true
    size: 5Gi   # Reduced from 10Gi
    storageClass: "local-path"
  resources:
    limits:
      cpu: 250m  # Reduced from 500m
      memory: 512Mi  # Reduced from 1Gi
    requests:
      cpu: 125m
      memory: 256Mi

# Disable ingress for single node (use port forwarding instead)
ingress:
  enabled: false

# Disable autoscaling for single node
autoscaling:
  enabled: false

# Relaxed security for single node development
security:
  networkPolicies:
    enabled: false
  podSecurityStandards:
    enabled: false
  rbac:
    enabled: true

networkPolicy:
  enabled: false