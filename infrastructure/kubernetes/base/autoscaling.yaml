# Horizontal Pod Autoscalers for JustNews services

# Auto-scaling for GPU-intensive agents
apiVersion: autoscaling/v2
kind: HorizontalPodAutoscaler
metadata:
  name: scout-hpa
  namespace: justnews
spec:
  scaleTargetRef:
    apiVersion: apps/v1
    kind: Deployment
    name: scout
  minReplicas: 1
  maxReplicas: 5
  metrics:
  - type: Resource
    resource:
      name: cpu
      target:
        type: Utilization
        averageUtilization: 70
  - type: Resource
    resource:
      name: memory
      target:
        type: Utilization
        averageUtilization: 80
  behavior:
    scaleDown:
      stabilizationWindowSeconds: 300
      policies:
      - type: Percent
        value: 50
        periodSeconds: 60

---
apiVersion: autoscaling/v2
kind: HorizontalPodAutoscaler
metadata:
  name: analyst-hpa
  namespace: justnews
spec:
  scaleTargetRef:
    apiVersion: apps/v1
    kind: Deployment
    name: analyst
  minReplicas: 1
  maxReplicas: 3
  metrics:
  - type: Resource
    resource:
      name: cpu
      target:
        type: Utilization
        averageUtilization: 70
  - type: Resource
    resource:
      name: memory
      target:
        type: Utilization
        averageUtilization: 80
  behavior:
    scaleDown:
      stabilizationWindowSeconds: 300
      policies:
      - type: Percent
        value: 50
        periodSeconds: 60

---
apiVersion: autoscaling/v2
kind: HorizontalPodAutoscaler
metadata:
  name: synthesizer-hpa
  namespace: justnews
spec:
  scaleTargetRef:
    apiVersion: apps/v1
    kind: Deployment
    name: synthesizer
  minReplicas: 1
  maxReplicas: 3
  metrics:
  - type: Resource
    resource:
      name: cpu
      target:
        type: Utilization
        averageUtilization: 70
  - type: Resource
    resource:
      name: memory
      target:
        type: Utilization
        averageUtilization: 80

---
# Auto-scaling for MCP Bus (communication hub)
apiVersion: autoscaling/v2
kind: HorizontalPodAutoscaler
metadata:
  name: mcp-bus-hpa
  namespace: justnews
spec:
  scaleTargetRef:
    apiVersion: apps/v1
    kind: Deployment
    name: mcp-bus
  minReplicas: 1
  maxReplicas: 3
  metrics:
  - type: Resource
    resource:
      name: cpu
      target:
        type: Utilization
        averageUtilization: 60
  - type: Resource
    resource:
      name: memory
      target:
        type: Utilization
        averageUtilization: 70

---
# Auto-scaling for Chief Editor (workflow orchestration)
apiVersion: autoscaling/v2
kind: HorizontalPodAutoscaler
metadata:
  name: chief-editor-hpa
  namespace: justnews
spec:
  scaleTargetRef:
    apiVersion: apps/v1
    kind: Deployment
    name: chief-editor
  minReplicas: 1
  maxReplicas: 2
  metrics:
  - type: Resource
    resource:
      name: cpu
      target:
        type: Utilization
        averageUtilization: 60
  - type: Resource
    resource:
      name: memory
      target:
        type: Utilization
        averageUtilization: 70

---
# Cluster-level resource management
apiVersion: v1
kind: ConfigMap
metadata:
  name: hpa-config
  namespace: justnews
data:
  scaling-policy.json: |
    {
      "gpuAgents": {
        "maxReplicas": 5,
        "scaleUpPeriod": 60,
        "scaleDownPeriod": 300,
        "cpuThreshold": 70,
        "memoryThreshold": 80
      },
      "cpuAgents": {
        "maxReplicas": 3,
        "scaleUpPeriod": 60,
        "scaleDownPeriod": 300,
        "cpuThreshold": 60,
        "memoryThreshold": 70
      },
      "cooldownPeriod": 300
    }