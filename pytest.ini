[pytest]
# Keep convenient import shortcuts for local test runs. `tests/conftest.py`
# now injects the repository root onto sys.path, and listing the root and
# `agents` package here keeps IDE-based invocations aligned with the CLI.
pythonpath =
	.
	agents

# Enable live CLI logging so pytest prints logging messages as tests run
# This helps the IDE show live output when tests are executed via the terminal
log_cli = true
log_cli_level = INFO
log_cli_format = %(asctime)s [%(levelname)s] %(name)s: %(message)s
log_cli_date_format = %H:%M:%S

# Exclude standalone scripts from test discovery
norecursedirs = .build scripts stored_archive third_party


## Ensure targeted third-party deprecation warnings are ignored BEFORE the global
## escalation to errors, so external library deprecations don't break the test run
## while still treating our own deprecations/future warnings as errors.
addopts = --import-mode=importlib \
	-W ignore:pkg_resources is deprecated as an API.:UserWarning \
	-W ignore:Deprecated\ call\ to\ `pkg_resources.declare_namespace':DeprecationWarning \
	-W ignore:Container uses PyType_Spec with a metaclass that has custom tp_new.:DeprecationWarning \
	-W ignore:Type google\._upb.*:DeprecationWarning \
	-W ignore:.*google\._upb.*:DeprecationWarning \
	-W ignore:.*pkg_resources.*:DeprecationWarning \
	-W ignore::DeprecationWarning:google._upb._message \
	-W ignore:tp_new:DeprecationWarning \
	-W error::DeprecationWarning -W error::FutureWarning -W error::Warning

# Custom markers
markers =
	integration: marks tests as integration tests that require services or heavy deps
	gpu: marks tests that require a CUDA-capable GPU
	slow: marks tests that are slow/heavy and not suitable for default CI
	model_store: marks tests that require a populated Model Store (STRICT_MODEL_STORE)

filterwarnings =
	error::DeprecationWarning
	error::FutureWarning
	error::Warning
	ignore:pkg_resources is deprecated as an API.:UserWarning
	# Upstream warning triggered by google._upb (PyType_Spec/tp_new) - ignore for now
	# upstream google._upb / PyType_Spec warnings are noisy on Python 3.12+. They are
	# third-party and unrelated to our code; ignore the specific message and module.
	# Broader/safer filters to catch variants or multi-line messages emitted by
	# importlib/_bootstrap for precompiled message types coming from google's
	# _upb bindings.
	ignore:Type google\._upb.*:DeprecationWarning
	ignore:.*google\._upb.*:DeprecationWarning
	ignore:.*pkg_resources.*:DeprecationWarning
	ignore:PyType_Spec:DeprecationWarning
	ignore::DeprecationWarning:google._upb._message
	ignore:Container uses PyType_Spec with a metaclass that has custom tp_new.:DeprecationWarning
	ignore:Deprecated call to `pkg_resources.declare_namespace':DeprecationWarning
